{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/pdfGenerator/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Weblog"}},"markdownRemark":{"id":"92290395-25f8-5491-8a3e-d3eac4b81ad9","excerpt":"Pdf 文書の必要性 生成した Pdf の例 Pdf 自動生成の流れ Express のルーティング Pdf 生成 共通の Header と Footer Pdf 作成 目次部分の CSS Pdf のパーサー まとめ Pdf…","html":"<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#pdf-%E6%96%87%E6%9B%B8%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7\">Pdf 文書の必要性</a></p>\n</li>\n<li>\n<p><a href=\"#%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F-pdf-%E3%81%AE%E4%BE%8B\">生成した Pdf の例</a></p>\n</li>\n<li>\n<p><a href=\"#pdf-%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E3%81%AE%E6%B5%81%E3%82%8C\">Pdf 自動生成の流れ</a></p>\n</li>\n<li>\n<p><a href=\"#express-%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\">Express のルーティング</a></p>\n</li>\n<li>\n<p><a href=\"#pdf-%E7%94%9F%E6%88%90\">Pdf 生成</a></p>\n<ul>\n<li><a href=\"#%E5%85%B1%E9%80%9A%E3%81%AE-header-%E3%81%A8-footer\">共通の Header と Footer</a></li>\n<li><a href=\"#pdf-%E4%BD%9C%E6%88%90\">Pdf 作成</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E7%9B%AE%E6%AC%A1%E9%83%A8%E5%88%86%E3%81%AE-css\">目次部分の CSS</a></p>\n</li>\n<li>\n<p><a href=\"#pdf-%E3%81%AE%E3%83%91%E3%83%BC%E3%82%B5%E3%83%BC\">Pdf のパーサー</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></p>\n</li>\n</ul>\n</div>\n<h2 id=\"pdf-文書の必要性\" style=\"position:relative;\"><a href=\"#pdf-%E6%96%87%E6%9B%B8%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7\" aria-label=\"pdf 文書の必要性 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pdf 文書の必要性</h2>\n<p>ウェブページで作成した取説について、関係者へ配布するときに、印刷またはオフラインで確認しやすいように、Pdf のようなフォーマットは望ましい。</p>\n<h2 id=\"生成した-pdf-の例\" style=\"position:relative;\"><a href=\"#%E7%94%9F%E6%88%90%E3%81%97%E3%81%9F-pdf-%E3%81%AE%E4%BE%8B\" aria-label=\"生成した pdf の例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>生成した Pdf の例</h2>\n<p>生成した Pdf の１ページ目の例。</p>\n<p>特徴は、目次（Table of Contents）の部分も自動生成させて、長い文書の内容が一目瞭然になっていること。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAABJ0AAASdAHeZh94AAACU0lEQVRIx+1WzWrbQBDWzdj3FB+amyF9B79H6BPkxw/gBzDULsXFpYeeGqgP6ROkkNqX5mQILkRuHCzFKaRViP8i/0rW/1dm5TWKayNBe2sHPsYe7Xw7s7Ozu8L3mxvIUgsnJ58gyTL6/T46nQ663e5G9Ho9KD9/4MvZGWq1GirVKtrtNhRFgTCbzTDXdUZimia4WJYVAhOqqmI0GuHhQWW+tm1DIIOma2iIIiRJwlXzCsrdHVzXDcWqaJoGYTgcsj/XsozLyyaazSYajW/M5nkewybh3/kYXdd9QpqNUg46e56LqML95vM5hMlkgtFojMPDDLLZLC4uRJimxQY4DqXmRYJte36Eg8GAOZ+ff8XOzjOkUim0WhIjjUpGsGwPGk+Zp/f+6AO2t58imUyiUCgwW1Rix1lESKXnUnrzDoIgMOzt7fvrYpgsdR/eBu3Cslw/wvF4DE3TUalUkS+8RC6XQ7FYxOnp58U6OuEReoEI+bY5OMggHo8jk8mgXC4vo6bZqYrkxJ0fadffNixCLVCU21sFu7vP8WRrC+l0GsfHHyHL1+ybbTuL9NbBT9nkhBSh49jMsfj6LVu/WCzGdD7vF8YwzdCUDXNBSEXhVX6Rf8WIEokE06VSKXKllymr6nC5Xvf3XdTrdYiiyDSdLCTUScE2Ww88Lsq6Zg+2VeTW44Sskq7LtgkHnyQ8upXDIWokYRH+J/wnCf8EvxH+DWGdQocDdYVhGGtBFzjNTHcu/V610wFNoAfD8gqgFqMBq68DbuOE3Ba000NhPJlgOp0ywl/GwlA27T97pgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Pdf画像例\"\n        title=\"Pdf画像例\"\n        src=\"/static/a9958e6c3cfdb110e89bc59105708997/6e88f/pdfsample.png\"\n        srcset=\"/static/a9958e6c3cfdb110e89bc59105708997/c26ae/pdfsample.png 158w,\n/static/a9958e6c3cfdb110e89bc59105708997/6bdcf/pdfsample.png 315w,\n/static/a9958e6c3cfdb110e89bc59105708997/6e88f/pdfsample.png 562w\"\n        sizes=\"(max-width: 562px) 100vw, 562px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"pdf-自動生成の流れ\" style=\"position:relative;\"><a href=\"#pdf-%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E3%81%AE%E6%B5%81%E3%82%8C\" aria-label=\"pdf 自動生成の流れ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pdf 自動生成の流れ</h2>\n<ol>\n<li><a href=\"https://expressjs.com/ja/\">Express</a>のルーティングによって Pdf 生成時のサーバサイドの関数を呼び出す</li>\n<li><a href=\"https://github.com/puppeteer/puppeteer\">puppeteer</a>を使って中間 Pdf を生成する</li>\n<li><a href=\"https://www.npmjs.com/package/pdf-parse\">pdf-parse</a>を使って生成した Pdf を解析し、目次に当たる内容とそのページ番号を抽出する</li>\n<li>バッファーの html の TOC 部にページ番号を追記する</li>\n<li>バッファーの html に対して、最終の Pdf を生成する</li>\n</ol>\n<h2 id=\"express-のルーティング\" style=\"position:relative;\"><a href=\"#express-%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\" aria-label=\"express のルーティング permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Express のルーティング</h2>\n<p>各ウェブサイトの url に<code class=\"language-text\">/Pdf/</code>をつけたことで、<code class=\"language-text\">ssr.js</code>が呼び出され、Pdf を生成する。そして、クライアントサイドに Pdf 文書としてダウンロードされる。</p>\n<div\n              class=\"gatsby-code-button-container customButtonContainerClass\"\n              data-toaster-id=\"46935372043337510000\"\n              data-toaster-class=\"gatsby-code-button-toaster customToasterClass\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text customToasterTextClass\"\n              data-toaster-text=\"コピー完了\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`app.get(/Pdf/, async (req, res, next) => {\n  var oriUrl = req.originalUrl;\n  oriUrl = oriUrl.replace(&quot;Pdf&quot;, &quot;&quot;);\n  const { Pdf, ttRenderMs } = await ssr(\n    \\`\\${req.protocol}://\\${req.get(&quot;host&quot;)}\\${oriUrl}\\`\n  );\n  res.set(\n    &quot;Server-Timing&quot;,\n    \\`Prerender;dur=\\${ttRenderMs};desc=&quot;Headless render time (ms)&quot;\\`\n  );\n  console.log(oriUrl);\n  var PdfTitle = oriUrl.replace(/\\//g, &quot; &quot;).trim().replace(/ /g, &quot;-&quot;);\n  console.log(PdfTitle);\n  res.setHeader(&quot;content-type&quot;, &quot;application/Pdf&quot;);\n  res.setHeader(&quot;content-Disposition&quot;, \\`attachment;filename=\\${PdfTitle}.Pdf\\`);\n  return res.status(200).send(Pdf); // Serve prerendered page as response.\n});`, `46935372043337510000`)\"\n            >\n              <div\n                class=\"gatsby-code-button customButtonClass\"\n                data-tooltip=\"コピー\"\n              >\n                <svg class=\"gatsby-code-button-icon customSvgIconClass\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n\n        <div class=\"gatsby-code-title\">\n          <span>server.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 11\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">Pdf</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> oriUrl <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>originalUrl<span class=\"token punctuation\">;</span>\n  oriUrl <span class=\"token operator\">=</span> oriUrl<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pdf\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Pdf<span class=\"token punctuation\">,</span> ttRenderMs <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">ssr</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>protocol<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">://</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"host\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>oriUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"Server-Timing\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Prerender;dur=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ttRenderMs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;desc=\"Headless render time (ms)\"</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>oriUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> PdfTitle <span class=\"token operator\">=</span> oriUrl<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"> </span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>PdfTitle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content-type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/Pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content-Disposition\"</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">attachment;filename=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>PdfTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.Pdf</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>Pdf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Serve prerendered page as response.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"pdf-生成\" style=\"position:relative;\"><a href=\"#pdf-%E7%94%9F%E6%88%90\" aria-label=\"pdf 生成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pdf 生成</h2>\n<h3 id=\"共通の-header-と-footer\" style=\"position:relative;\"><a href=\"#%E5%85%B1%E9%80%9A%E3%81%AE-header-%E3%81%A8-footer\" aria-label=\"共通の header と footer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>共通の Header と Footer</h3>\n<p><code class=\"language-text\">headerTemplate</code>の<code class=\"language-text\">src</code>に、ロゴの画像の Raw データを入れることで、ロゴが各 Pdf のページの左上に印刷される。</p>\n<div\n              class=\"gatsby-code-button-container customButtonContainerClass\"\n              data-toaster-id=\"75821001564651950000\"\n              data-toaster-class=\"gatsby-code-button-toaster customToasterClass\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text customToasterTextClass\"\n              data-toaster-text=\"コピー完了\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`  const currentDatatime = new Date().toLocaleString({ timeZone: &quot;Asia/Tokyo&quot; });\n\n  headerTemplate = \\`<div style=&quot;position: relative; top: 0px; left: 0px; width: 100%; border-bottom: 1px solid black; margin: -5px 30px 0px; padding: 0px 0px 1px; font-size: 9px; font-family: Meiryo, Arial, sans-serif;&quot;>\n<div style=&quot;top: 0px; left: 0px; width: 200px; height: 35px; margin: 0px; padding: 0px&quot;>\n<image height=&quot;30px&quot; src=&quot;data:image/png;base64,.....&quot; />\n</div><div style=&quot;position: absolute; top: 20px;right: 0px;text-align: right; margin: 0px; padding: 0px;&quot;>Copyright &copy;  CO.,LTD.</div>\n</div>\\`;\n\n  footerTemplate = \\`<div style=&quot;position: relative; width: 100%; border-top: 1px solid black; margin: 0px 30px 25px; padding: 1px, 0px, 0px; font-size: 9px; font-family: Meiryo, Arial, sans-serif;&quot;>\n  <div style=&quot;position: absolute; top: 5px; left: 0px; text-align: left;&quot;>\n  <span class=&quot;title&quot;></span></div>\n  <div style=&quot;position: absolute; top: 5px; width: 100%; text-align: center;&quot;>\n  <span class=&quot;pageNumber&quot;></span> / <span class=&quot;totalPages&quot;></span></div>\n  <div style=&quot;position: absolute; top: 5px; right: 0px; text-align: right;&quot;>\\${currentDatatime}</div></div>\\`;`, `75821001564651950000`)\"\n            >\n              <div\n                class=\"gatsby-code-button customButtonClass\"\n                data-tooltip=\"コピー\"\n              >\n                <svg class=\"gatsby-code-button-icon customSvgIconClass\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n\n        <div class=\"gatsby-code-title\">\n          <span>ssr.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 15\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">  <span class=\"token keyword\">const</span> currentDatatime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">timeZone</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Asia/Tokyo\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  headerTemplate <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div style=\"position: relative; top: 0px; left: 0px; width: 100%; border-bottom: 1px solid black; margin: -5px 30px 0px; padding: 0px 0px 1px; font-size: 9px; font-family: Meiryo, Arial, sans-serif;\">\n&lt;div style=\"top: 0px; left: 0px; width: 200px; height: 35px; margin: 0px; padding: 0px\">\n&lt;image height=\"30px\" src=\"data:image/png;base64,.....\" />\n&lt;/div>&lt;div style=\"position: absolute; top: 20px;right: 0px;text-align: right; margin: 0px; padding: 0px;\">Copyright &amp;copy;  CO.,LTD.&lt;/div>\n&lt;/div></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n  footerTemplate <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div style=\"position: relative; width: 100%; border-top: 1px solid black; margin: 0px 30px 25px; padding: 1px, 0px, 0px; font-size: 9px; font-family: Meiryo, Arial, sans-serif;\">\n  &lt;div style=\"position: absolute; top: 5px; left: 0px; text-align: left;\">\n  &lt;span class=\"title\">&lt;/span>&lt;/div>\n  &lt;div style=\"position: absolute; top: 5px; width: 100%; text-align: center;\">\n  &lt;span class=\"pageNumber\">&lt;/span> / &lt;span class=\"totalPages\">&lt;/span>&lt;/div>\n  &lt;div style=\"position: absolute; top: 5px; right: 0px; text-align: right;\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>currentDatatime<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>&lt;/div></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"pdf-作成\" style=\"position:relative;\"><a href=\"#pdf-%E4%BD%9C%E6%88%90\" aria-label=\"pdf 作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pdf 作成</h3>\n<p><code class=\"language-text\">executablePath</code>は実際の Headless Chrome の exe のパスに書き換えてください。</p>\n<div\n              class=\"gatsby-code-button-container customButtonContainerClass\"\n              data-toaster-id=\"11404176384547715000\"\n              data-toaster-class=\"gatsby-code-button-toaster customToasterClass\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text customToasterTextClass\"\n              data-toaster-text=\"コピー完了\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`  const browser = await puppeteer.launch({\n    executablePath:\n      &quot;./node_modules/puppeteer/.local-chromium/win32-555668/chrome-win32/chrome.exe&quot;,\n  });\n  const page = await browser.newPage();\n\n  const PdfInter = await page.Pdf({\n    format: &quot;A4&quot;,\n    displayHeaderFooter: true,\n    headerTemplate: headerTemplate, // indicate html template for header\n    footerTemplate: footerTemplate, // indicate html template for header\n    margin: {\n      // increase margins (in this example, required!)\n      top: 80,\n      bottom: 80,\n      left: 30,\n      right: 30,\n    },\n  });`, `11404176384547715000`)\"\n            >\n              <div\n                class=\"gatsby-code-button customButtonClass\"\n                data-tooltip=\"コピー\"\n              >\n                <svg class=\"gatsby-code-button-icon customSvgIconClass\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n\n        <div class=\"gatsby-code-title\">\n          <span>ssr.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 80\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">executablePath</span><span class=\"token operator\">:</span>\n      <span class=\"token string\">\"./node_modules/puppeteer/.local-chromium/win32-555668/chrome-win32/chrome.exe\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> PdfInter <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">Pdf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">format</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A4\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">displayHeaderFooter</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headerTemplate</span><span class=\"token operator\">:</span> headerTemplate<span class=\"token punctuation\">,</span> <span class=\"token comment\">// indicate html template for header</span>\n    <span class=\"token literal-property property\">footerTemplate</span><span class=\"token operator\">:</span> footerTemplate<span class=\"token punctuation\">,</span> <span class=\"token comment\">// indicate html template for header</span>\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// increase margins (in this example, required!)</span>\n      <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"目次部分の-css\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E6%AC%A1%E9%83%A8%E5%88%86%E3%81%AE-css\" aria-label=\"目次部分の css permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目次部分の CSS</h2>\n<p>目次の部分については、<code class=\"language-text\">ul>li</code>の構造で、点線（Dot Leaders）を追加するために、CSS の中で下記のように記述すること。</p>\n<p>Leaders の CSS 記述について、<a href=\"https://www.w3.org/Style/Examples/007/leaders.en.html\">W3C DOT LEADERS</a>を参考してください。</p>\n<div\n              class=\"gatsby-code-button-container customButtonContainerClass\"\n              data-toaster-id=\"13078951757209766000\"\n              data-toaster-class=\"gatsby-code-button-toaster customToasterClass\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text customToasterTextClass\"\n              data-toaster-text=\"コピー完了\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`@media print {\n    ul li {\n        position:relative\n    }\n    ul li .toc-page-number {\n        float:right\n    }\n    ul li{\n        padding: 0;\n        overflow-x: hidden;\n        margin:0 0 24pt;\n        list-style: none;\n        list-style-type:none;\n    }\n    ul li,\n    ul li a,\n    .toc-page-number{\n        background:white;\n    }\n    ul li a:before {\n        float:left;\n        width:0;\n        white-space:nowrap;\n        content:\n    &quot;. . . . . . . . . . . . . . . . . . . . &quot;\n    &quot;. . . . . . . . . . . . . . . . . . . . &quot;\n    &quot;. . . . . . . . . . . . . . . . . . . . &quot;\n    &quot;. . . . . . . . . . . . . . . . . . . . &quot;\n    &quot;. . . . . . . . . . . . . . . . . . . . &quot;;\n    }\n}`, `13078951757209766000`)\"\n            >\n              <div\n                class=\"gatsby-code-button customButtonClass\"\n                data-tooltip=\"コピー\"\n              >\n                <svg class=\"gatsby-code-button-icon customSvgIconClass\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n\n        <div class=\"gatsby-code-title\">\n          <span>print.css</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"css\"><pre style=\"counter-reset: linenumber 0\" class=\"language-css line-numbers\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@media</span> print</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">ul li</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span>relative\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">ul li .toc-page-number</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">float</span><span class=\"token punctuation\">:</span>right\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">ul li</span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">overflow-x</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span>0 0 24pt<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">list-style</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">list-style-type</span><span class=\"token punctuation\">:</span>none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">ul li,\n    ul li a,\n    .toc-page-number</span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">background</span><span class=\"token punctuation\">:</span>white<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">ul li a:before</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">float</span><span class=\"token punctuation\">:</span>left<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span>0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span>nowrap<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">content</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">\". . . . . . . . . . . . . . . . . . . . \"</span>\n    <span class=\"token string\">\". . . . . . . . . . . . . . . . . . . . \"</span>\n    <span class=\"token string\">\". . . . . . . . . . . . . . . . . . . . \"</span>\n    <span class=\"token string\">\". . . . . . . . . . . . . . . . . . . . \"</span>\n    <span class=\"token string\">\". . . . . . . . . . . . . . . . . . . . \"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"pdf-のパーサー\" style=\"position:relative;\"><a href=\"#pdf-%E3%81%AE%E3%83%91%E3%83%BC%E3%82%B5%E3%83%BC\" aria-label=\"pdf のパーサー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pdf のパーサー</h2>\n<p>Pdf 文書の中に、TOC の各項目に当たる文字列を抽出して、<code class=\"language-text\">tocFilterdArray</code>の中に格納する。そして、各ページに当文字列があった場合、そのページの番号を<code class=\"language-text\">pageNumbers</code>に格納する。</p>\n<p>最後に、html の TOC の部分のページ番号に当たる箇所に、Pdf の解析結果<code class=\"language-text\">pageNumbers</code>を挿入する。</p>\n<div\n              class=\"gatsby-code-button-container customButtonContainerClass\"\n              data-toaster-id=\"77126514596423170000\"\n              data-toaster-class=\"gatsby-code-button-toaster customToasterClass\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text customToasterTextClass\"\n              data-toaster-text=\"コピー完了\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`  var Pdf2 = require(&quot;pdf-parse&quot;);\n\n  await Pdf2(PdfInter)\n    .then(function (data) {\n      var text = data.text;\n      var stringArray = text.split(&quot;\\n&quot;);\n      var tocFilterdArray = [];\n      for (const elem of stringArray) {\n        if (elem.startsWith(&quot;. . . . . . . . .&quot;) === true) {\n          var tempStr = elem.replace(/^([. ]*)/g, &quot;&quot;);\n          tempStr = tempStr.replace(/([. ]*)\\$/g, &quot;&quot;);\n          tocFilterdArray.push(tempStr);\n        }\n      }\n\n      var filterdArray = [];\n      var currentPage = 1;\n      for (const elem of stringArray) {\n        if (elem.endsWith(currentDatatime) === true) {\n          if (elem.startsWith(pagetitle) === true) {\n            var tempStr = elem\n              .replace(currentDatatime, &quot;&quot;)\n              .replace(pagetitle, &quot;&quot;);\n            var temparr = tempStr.split(&quot;/&quot;);\n            currentPage = temparr[0].trim();\n            filterdArray.push(currentPage);\n            console.log(&quot;Push: &quot; + currentPage);\n          }\n        }\n        if (tocFilterdArray.includes(elem) === true) {\n          filterdArray.push(elem);\n          pageNumbers.push(parseInt(currentPage));\n        }\n      }\n      const tocEl = root.querySelectorAll(&quot;.toc-page-number&quot;);\n      let pageNumberCorrect = 0;\n      tocEl.forEach((element) => {\n        const tempValue = pageNumbers[pageNumberCorrect];\n        element.set_content(String(tempValue));\n        pageNumberCorrect = pageNumberCorrect + 1;\n      });\n    })\n    .catch(function (err) {\n      console.log(err);\n    });`, `77126514596423170000`)\"\n            >\n              <div\n                class=\"gatsby-code-button customButtonClass\"\n                data-tooltip=\"コピー\"\n              >\n                <svg class=\"gatsby-code-button-icon customSvgIconClass\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z\"/></svg>\n              </div>\n            </div>\n\n        <div class=\"gatsby-code-title\">\n          <span>ssr.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 104\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">  <span class=\"token keyword\">var</span> Pdf2 <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pdf-parse\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token function\">Pdf2</span><span class=\"token punctuation\">(</span>PdfInter<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> stringArray <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> tocFilterdArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> elem <span class=\"token keyword\">of</span> stringArray<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\". . . . . . . . .\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">var</span> tempStr <span class=\"token operator\">=</span> elem<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^([. ]*)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          tempStr <span class=\"token operator\">=</span> tempStr<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">([. ]*)$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          tocFilterdArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>tempStr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">var</span> filterdArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">var</span> currentPage <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> elem <span class=\"token keyword\">of</span> stringArray<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span>currentDatatime<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span>pagetitle<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> tempStr <span class=\"token operator\">=</span> elem\n              <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>currentDatatime<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>pagetitle<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> temparr <span class=\"token operator\">=</span> tempStr<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            currentPage <span class=\"token operator\">=</span> temparr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            filterdArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Push: \"</span> <span class=\"token operator\">+</span> currentPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tocFilterdArray<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          filterdArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>elem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          pageNumbers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>currentPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">const</span> tocEl <span class=\"token operator\">=</span> root<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".toc-page-number\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">let</span> pageNumberCorrect <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      tocEl<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> tempValue <span class=\"token operator\">=</span> pageNumbers<span class=\"token punctuation\">[</span>pageNumberCorrect<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        element<span class=\"token punctuation\">.</span><span class=\"token function\">set_content</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>tempValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        pageNumberCorrect <span class=\"token operator\">=</span> pageNumberCorrect <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記最終に生成された html を再度 puppeteer を使って Pdf を生成させることで、目次付きの Pdf の作成が可能。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Headless chrome puppeteer を使うことで、pdf 文書を簡単に生成できる。また、生成した Pdf の文書をメモリ上で解析することで、目次に必要なページ番号を抽出可能。抽出したページ番号を html に挿入し、Pdf を再作成すると、目次付きの文書が作れる。</p>\n<p>この事例を通じて、サーバーサイドで Pdf データまた html データを解析また操作する方法を覚えていただき、是非活用してください。</p>","frontmatter":{"title":"ウェブページのPdf生成","date":"March 20, 2022","description":"Headless Chrome Puppeteerを使って、ウェブページのPdf文書を自動生成する","tags":["puppeteer","Table of Contents"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABP0lEQVQoz5WRv0rDUBTG4xv0AfRxxEl8gdpBseBqp6ogtOrkIKVCAqUFwSFDWpobOgpFF6esaf5QEkJDbDRpTUM7JJ940WILSvIt53LPd3989xwGv5QkCa3RZIq9ehX5bgP2aISR46AgNbFbryAKJivedTHrwPjbyD7cY/PsEAxXwgZXwlb5AHetxtKXGvilxSxCoXaFXOUI2zen2KldIHd9jPxtFYtwli0hBc7nKF6eo/v0uOxJL8/YL5/gYzpND4zjmNbhcAi2Vseb+wrN0KFqGibeO5osB2UwWPGmAsqyjGarhXa7DUIIiEggigSCINBeauDPN3Rd//OBpmnZZ6goCjqdDiRJoql6vR54nke/34dhGNmBqqoiDEM4jgPbthEEAcbjMXzfp+kzA03TpIvxPI+CXNelZ8uy6P1/wE9UIuUaumzvKwAAAABJRU5ErkJggg==","aspectRatio":1.927710843373494,"src":"/static/29797c80d6a20153d823c7e291f9c434/c57d4/puppeteer.png","srcSet":"/static/29797c80d6a20153d823c7e291f9c434/dd5bb/puppeteer.png 320w,\n/static/29797c80d6a20153d823c7e291f9c434/f3dec/puppeteer.png 640w,\n/static/29797c80d6a20153d823c7e291f9c434/c57d4/puppeteer.png 814w","sizes":"(max-width: 814px) 100vw, 814px"}}}}},"previous":{"fields":{"slug":"/ssg/"},"frontmatter":{"title":"Static site generator：Mkdocs"}},"next":null},"pageContext":{"id":"92290395-25f8-5491-8a3e-d3eac4b81ad9","previousPostId":"220a857b-5c50-532d-9fce-49d12d207c59","nextPostId":null}},
    "staticQueryHashes": ["2841359383","3257411868"]}